from dataclasses import dataclass
from typing import Optional
import logging
import uuid


logger = logging.getLogger(__name__)


class ValidationError(Exception):
    """Raised when input validation fails."""
    pass


@dataclass
class CreateRequest:
    """Request to create a resource."""
    name: str
    description: str


@dataclass
class CreateResponse:
    """Response from resource creation."""
    id: str
    reference: str


class ExampleService:
    """Example service demonstrating the service layer pattern."""
    
    def __init__(
        self,
        logger: Optional[logging.Logger] = None,
        telemetry: Optional[object] = None,
        db: Optional[object] = None,
    ):
        self.logger = logger or logging.getLogger(__name__)
        self.telemetry = telemetry
        self.db = db
    
    def create(self, request: CreateRequest) -> CreateResponse:
        """
        Create a new resource.
        
        Args:
            request: Creation request
            
        Returns:
            Creation response with ID and reference
            
        Raises:
            ValidationError: If the input is invalid
        """
        self.logger.info(
            f"Creating resource: {request.name} - {request.description}"
        )
        
        # Example validation
        if not request.name or len(request.name) < 3:
            raise ValidationError(f"Invalid name: {request.name}")
        
        if not request.description:
            raise ValidationError("Description is required")
        
        # Generate resource ID and reference
        resource_id = str(uuid.uuid4())
        reference = f"REF-{uuid.uuid4().hex[:8].upper()}"
        
        # TODO: Implement actual creation logic
        # if self.db:
        #     session = self.db.get_session()
        #     # Perform database operations
        
        self.logger.info(f"Resource created: {resource_id} ({reference})")
        
        return CreateResponse(id=resource_id, reference=reference)
